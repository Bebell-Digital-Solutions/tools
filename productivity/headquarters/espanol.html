<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Headquarters</title>

     <link rel="icon" href="https://bucket.mlcdn.com/a/3336/3336910/images/6794eefa1bcbd44c0a755ed64a2b841a564face8.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script> 
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --primary: #df1783;
            --secondary: #8c318f;
            --accent: rgba(255,255,255,0.1);
            --light: #f8f9fa;
            --dark-bg: #1a202c;
            --dark-card: #2d3748;
            --dark-text: #e2e8f0;
        }

        html.dark {
            --light: var(--dark-bg);
            --dark-text: #e2e8f0;
        }

        .custom-image-widget {
            position: fixed !important;
            top: 50px !important;
            margin: 0 !important;
            padding: 0 !important;
            right: 0px;
            z-index: 999;
        }
        
        .custom-image {
            width: 70px;
            height: auto;
            transition: transform 0.2s;
        }
        
        .custom-image-widget:hover .custom-image {
            transform: scale(1.2);
        }
        
        .custom-image-widget:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
                
        body {
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            min-height: 100vh;
            background-color: #eef2f7;
            color: #333;
        }

        html.dark body {
            background-color: var(--dark-bg);
            color: var(--dark-text);
        }

        .sidebar {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            transition: background 0.5s ease;
        }

        .nav-item {
            transition: all 0.3s;
        }

        .nav-item:hover {
            background-color: var(--accent);
        }

        .nav-item.active {
            background-color: var(--accent);
            font-weight: bold;
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        html.dark .card {
            background: var(--dark-card);
        }

        input, select, textarea {
            background-color: #fbfbfb;
            border: 1px solid #ddd;
            border-radius: 0.375rem;
            color: #333;
            transition: all 0.2s;
        }
        html.dark input, html.dark select, html.dark textarea {
            background-color: #4a5568;
            border-color: #718096;
            color: var(--dark-text);
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary) !important;
            box-shadow: 0 0 0 2px rgba(223, 23, 131, 0.2);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-weight: 600;
            border-radius: 0.5rem;
            transition: background-color 0.3s;
            cursor: pointer;
            border: none;
            padding: 10px 20px;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        .btn-primary:hover {
            background-color: var(--secondary);
        }

        .bg-primary { background-color: var(--primary); }

        /* Pomodoro Styles */
        @keyframes pulse-red {
            0%, 100% { box-shadow: 0 4px 12px rgba(0,0,0,0.08); border-color: transparent; }
            50% { box-shadow: 0 0 20px rgba(239, 68, 68, 0.6); border-color: #ef4444; }
        }
        
        .pomodoro-warning {
            animation: pulse-red 1s infinite;
        }

        /* Calendar Styles */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background-color: #e2e8f0;
        }
        html.dark .calendar-grid { background-color: #4a5568; }

        .calendar-day, .calendar-header {
            background-color: white;
            padding: 8px;
        }
        html.dark .calendar-day, html.dark .calendar-header { background-color: var(--dark-card); }
        .calendar-header { font-weight: bold; text-align: center; }

        .calendar-day { min-height: 120px; }
        .calendar-day.other-month { background-color: #f1f5f9; }
        html.dark .calendar-day.other-month { background-color: #1a202c; color: #718096; }

        .calendar-task {
            background-color: #fecdd3;
            color: var(--primary);
            border-left: 3px solid var(--primary);
        }
        html.dark .calendar-task { background-color: #b91c1c; color: white; }

        /* Modal Styles */
        #modal-container {
            transition: opacity 0.3s ease;
        }
        #modal-content {
            transition: transform 0.3s ease;
        }

        .save-notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #22c55e;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .save-notification.show {
            opacity: 1;
            transform: translateY(0);
        }

        .section-footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
            text-align: center;
            font-size: 14px;
        }
        html.dark .section-footer {
            border-top-color: #4a5568;
            color: #a0aec0;
        }
        
        /* Kanban Styles */
        .kanban-task {
            cursor: grab;
        }
        .kanban-task.dragging {
            opacity: 0.5;
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        .kanban-col.drag-over {
            background-color: var(--accent);
            border-radius: 0.5rem;
        }
        html.dark .kanban-col.drag-over {
             background-color: rgba(255, 255, 255, 0.05);
        }

        /* Flip Clock Styles */
        .flip-clock-digit {
            background-color: var(--primary);
            color: white;
            font-family: monospace;
            border-radius: 4px;
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 1.4rem;
            height: 2.2rem;
            line-height: 2.2rem;
            font-size: 1.25rem;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            perspective: 400px;
        }
        .flip-clock-digit::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: rgba(0,0,0,0.3);
            box-shadow: 0 1px 0 rgba(255,255,255,0.1);
        }
        .animate-flip {
            animation: flipKey 0.6s ease-in-out;
        }
        @keyframes flipKey {
            0% { transform: rotateX(0deg); }
            50% { transform: rotateX(90deg); opacity: 0.7; }
            100% { transform: rotateX(0deg); }
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-dark-bg flex h-screen">

    <div class="sidebar w-64 flex-shrink-0 flex flex-col p-6">
        <div class="mb-10">
            <div class="w-16 h-16 bg-white/20 rounded-xl flex items-center justify-center mb-4">
                <i data-lucide="zap" class="w-8 h-8 text-white"></i>
            </div>
            <h1 class="text-3xl font-bold text-white mb-2">Headquarters</h1>
            <p class="text-white/80 text-sm leading-relaxed">Tu centro de mando de productividad.</p>
        </div>
        
        <nav class="flex-grow space-y-2">
            <div id="nav-dashboard" class="nav-item active flex items-center gap-3 px-4 py-3 rounded-lg cursor-pointer" data-view="dashboard"><i data-lucide="layout-dashboard"></i><span>Panel de Control</span></div>
            <div id="nav-tasks" class="nav-item flex items-center gap-3 px-4 py-3 rounded-lg cursor-pointer" data-view="tasks"><i data-lucide="check-square"></i><span>Tareas</span></div>
            <div id="nav-projects" class="nav-item flex items-center gap-3 px-4 py-3 rounded-lg cursor-pointer" data-view="projects"><i data-lucide="folder-kanban"></i><span>Proyectos</span></div>
            <div id="nav-notes" class="nav-item flex items-center gap-3 px-4 py-3 rounded-lg cursor-pointer" data-view="notes"><i data-lucide="notebook-pen"></i><span>Notas</span></div>
            <div id="nav-calendar" class="nav-item flex items-center gap-3 px-4 py-3 rounded-lg cursor-pointer" data-view="calendar"><i data-lucide="calendar-days"></i><span>Calendario</span></div>
            
            <div id="nav-ai-assistant" class="nav-item flex items-center gap-3 px-4 py-3 rounded-lg cursor-pointer" 
                 data-view="iframe-view" 
                 data-iframe-url="https://bebell-digital-solutions.github.io/aiba-deepseek/es-v03">
                <i data-lucide="bot"></i><span>Asistente IA</span>
            </div>
        </nav>

        <div class="space-y-3 mt-auto">
             <button id="settings-btn" class="w-full flex items-center gap-3 px-4 py-3 rounded-lg cursor-pointer hover:bg-accent text-left">
                <i data-lucide="settings" class="w-5 h-5"></i><span>ConfiguraciÃ³n</span>
            </button>
            <button id="theme-toggle" class="w-full flex items-center gap-3 px-4 py-3 rounded-lg cursor-pointer hover:bg-accent text-left">
                <i data-lucide="sun" class="w-5 h-5"></i><span>Modo Claro</span>
            </button>
            <a href="https://www.notion.so/templates" target="_blank" class="flex items-center gap-3 px-4 py-3 rounded-lg cursor-pointer hover:bg-accent">
                 <i data-lucide="download" class="w-5 h-5"></i><span>Plantillas Notion</span>
            </a>
        </div>
    </div>

    <main class="flex-grow p-8 overflow-y-auto relative">
        
        <section id="dashboard" class="section space-y-8">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h1 class="text-4xl font-bold">Panel de Control</h1>
                    <p class="text-gray-500 dark:text-gray-400 mt-1">AquÃ­ estÃ¡ tu resumen de productividad para hoy.</p>
                </div>
                
                <div class="flex flex-col items-end md:items-center">
                    <span class="text-[10px] uppercase tracking-widest font-light mb-1 text-gray-500 dark:text-gray-400">Pomodoro</span>
                    <div id="pomodoro-widget" class="card flex items-center gap-4 px-6 py-3 transition-all transform hover:scale-105 border-2 border-transparent">
                        <div id="pomodoro-display" class="flex items-center gap-1">
                            <div id="digit-m1" class="flip-clock-digit">2</div>
                            <div id="digit-m2" class="flip-clock-digit">5</div>
                            <div class="font-bold text-gray-400 dark:text-gray-500 px-0.5">:</div>
                            <div id="digit-s1" class="flip-clock-digit">0</div>
                            <div id="digit-s2" class="flip-clock-digit">0</div>
                        </div>
                        <button id="pomodoro-btn" class="p-1.5 text-primary hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors focus:outline-none focus:ring-2 focus:ring-primary/50" title="Start/Pause">
                            <i data-lucide="play" class="w-5 h-5 fill-current"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <button id="btn-add-task" class="btn btn-primary text-lg font-semibold p-6">
                    <i data-lucide="plus-circle"></i> Nueva Tarea
                </button>
                <button id="btn-add-note" class="btn btn-primary text-lg font-semibold p-6">
                    <i data-lucide="plus-circle"></i> Nota RÃ¡pida
                </button>
                <button id="btn-add-project" class="btn btn-primary text-lg font-semibold p-6">
                    <i data-lucide="plus-circle"></i> Nuevo Proyecto
                </button>
            </div>

             <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="dashboard-stats">
                </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="card p-6 flex flex-col">
                    <h2 class="text-xl font-bold mb-4 flex-shrink-0">Estado de FinalizaciÃ³n</h2>
                    <div class="relative flex-grow min-h-[250px]">
                        <canvas id="task-completion-chart"></canvas>
                    </div>
                </div>
                <div class="card p-6 flex flex-col">
                    <h2 class="text-xl font-bold mb-4 flex-shrink-0">Fechas LÃ­mite de esta Semana</h2>
                    <div id="weekly-deadlines" class="flex-grow overflow-y-auto max-h-[268px]">
                        </div>
                </div>
            </div>

            <div class="card p-6">
                 <h2 class="text-xl font-bold mb-4">Resumen de Tareas</h2>
                 <div id="dashboard-tasks" class="text-gray-600 dark:text-gray-300">Cargando tareas...</div>
            </div>

            <div class="card p-6">
                <h2 class="text-xl font-bold mb-4">Vista Previa del Calendario</h2>
                <div id="dashboard-calendar-preview">Cargando calendario...</div>
            </div>
        </section>

        <section id="tasks" class="section hidden">
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-4xl font-bold">Tareas</h1>
                <button id="add-task-from-view" class="btn btn-primary">
                    <i data-lucide="plus"></i> Nueva Tarea
                </button>
            </div>
            <div id="tasks-filter-container" class="card p-4 mb-6"></div>
            <div id="tasks-list" class="space-y-4"></div>
        </section>

        <section id="projects" class="section hidden">
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-4xl font-bold">Proyectos</h1>
                 <button id="add-project-from-view" class="btn btn-primary">
                    <i data-lucide="plus"></i> Nuevo Proyecto
                </button>
            </div>
            <div id="projects-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </section>

        <section id="notes" class="section hidden">
             <div class="flex justify-between items-center mb-6">
                <h1 class="text-4xl font-bold">Notas</h1>
                 <button id="add-note-from-view" class="btn btn-primary">
                    <i data-lucide="plus"></i> Nueva Nota
                </button>
            </div>
            <div id="notes-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </section>

        <section id="calendar" class="section hidden space-y-6">
            <div class="flex flex-wrap justify-between items-center gap-4">
                <h1 class="text-4xl font-bold">Calendario</h1>
                <div class="flex items-center gap-4">
                    <div class="flex items-center gap-2">
                         <button id="sync-google-btn" class="btn bg-blue-500 hover:bg-blue-600 text-white text-sm py-2">
                             <i data-lucide="calendar-plus"></i> Sincronizar con Google
                         </button>
                        <button id="download-ics-btn" class="btn bg-green-500 hover:bg-green-600 text-white text-sm py-2">
                           <i data-lucide="download-cloud"></i> Descargar .ICS
                        </button>
                    </div>
                    <div class="flex items-center border rounded-lg p-1 bg-gray-200 dark:bg-gray-700">
                        <button id="calendar-view-month" class="px-3 py-1 text-sm rounded-md">Mes</button>
                        <button id="calendar-view-week" class="px-3 py-1 text-sm rounded-md">Semana</button>
                    </div>
                </div>
            </div>
            
            <div class="card p-6">
                <h2 class="text-2xl font-bold mb-4">Tareas de Hoy</h2>
                <div id="calendar-today-tasks"></div>
            </div>

            <div class="card p-6">
                <div class="flex justify-between items-center mb-4">
                     <button id="calendar-prev" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600"><i data-lucide="chevron-left"></i></button>
                     <h2 id="calendar-title" class="text-2xl font-bold"></h2>
                     <button id="calendar-next" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600"><i data-lucide="chevron-right"></i></button>
                </div>
                <div id="calendar-container"></div>
            </div>
        </section>
        
        <section id="iframe-view" class="section hidden h-full flex flex-col">
            <h1 id="iframe-title" class="text-4xl font-bold mb-6 flex-shrink-0"></h1>
            <div class="flex-grow rounded-xl overflow-hidden shadow-lg">
                <iframe id="content-iframe" class="w-full h-full border-0" src="about:blank"></iframe>
            </div>
        </section>

        <section id="kanban-view" class="section hidden h-full flex flex-col">
            <div class="flex justify-between items-center mb-6 flex-shrink-0">
                <h1 class="text-4xl font-bold truncate pr-4">Kanban: <span id="kanban-project-title"></span></h1>
                <button id="back-to-projects-btn" class="btn bg-gray-200 dark:bg-gray-600 dark:text-white">
                    <i data-lucide="arrow-left"></i>
                    <span class="hidden sm:inline">Volver a Proyectos</span>
                </button>
            </div>
            <div id="kanban-board" class="flex-grow grid grid-cols-1 md:grid-cols-3 gap-6 overflow-x-auto">
                <div class="kanban-col bg-gray-200/50 dark:bg-dark-bg/50 p-4 rounded-lg flex flex-col">
                    <h2 class="font-bold text-lg mb-4 pb-2 border-b-2 border-red-500 flex-shrink-0">Pendiente</h2>
                    <div id="kanban-pending" class="kanban-tasks-container space-y-4 min-h-[200px] flex-grow overflow-y-auto"></div>
                </div>
                <div class="kanban-col bg-gray-200/50 dark:bg-dark-bg/50 p-4 rounded-lg flex flex-col">
                    <h2 class="font-bold text-lg mb-4 pb-2 border-b-2 border-yellow-500 flex-shrink-0">En Progreso</h2>
                    <div id="kanban-progress" class="kanban-tasks-container space-y-4 min-h-[200px] flex-grow overflow-y-auto"></div>
                </div>
                <div class="kanban-col bg-gray-200/50 dark:bg-dark-bg/50 p-4 rounded-lg flex flex-col">
                    <h2 class="font-bold text-lg mb-4 pb-2 border-b-2 border-green-500 flex-shrink-0">Hecho</h2>
                    <div id="kanban-done" class="kanban-tasks-container space-y-4 min-h-[200px] flex-grow overflow-y-auto"></div>
                </div>
            </div>
        </section>

        <footer class="section-footer">
            <p>Desarrollado con ðŸ’– por <a href="https://bebelldigitalsolutions.com" target="_blank" rel="noopener noreferrer" class="hover:underline"><strong style="color:var(--primary);">Bebell Digital Solutions</strong></a></p>
            <p>Copyright Â© 2025 â€¢ All rights reserved</p>
        </footer>
    </main>

    <div id="modal-container" class="fixed inset-0 z-50 bg-black/60 hidden items-center justify-center p-4 opacity-0">
        <div id="modal-content" class="card w-full max-w-2xl transform -translate-y-10">
            <div class="flex justify-between items-center p-4 border-b dark:border-gray-600">
                <h2 id="modal-title" class="text-2xl font-bold">Modal Title</h2>
                <button id="modal-close" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600"><i data-lucide="x"></i></button>
            </div>
            <div id="modal-body" class="p-6 max-h-[70vh] overflow-y-auto">
            </div>
        </div>
    </div>

    <div class="save-notification" id="saveNotification">
        Â¡Datos guardados exitosamente!
    </div>

<script>(function(d, s, id){
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = 'https://api.helpdesk.icu/widget/6cb4c417-1da5-31ec-ae0d-b1f79dad581f?r=' + encodeURIComponent(window.location);
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'contactus-jssdk'));</script>

    <script>
        (function() {
            'use strict';

            const state = {
                tasks: [],
                projects: [],
                notes: [],
                activeView: 'dashboard',
                activeProjectId: null,
                calendarDate: new Date(),
                calendarView: 'month',
                taskSearchQuery: '',
                activeTagFilter: null,
                primaryColor: '#df1783',
                secondaryColor: '#8c318f',
                language: 'es'
            };
            let taskCompletionChart = null;

            const translations = {
                en: {
                    "dashboard": "Dashboard",
                    "tasks": "Tasks",
                    "projects": "Projects",
                    "notes": "Notes",
                    "calendar": "Calendar",
                    "ai_assistant": "AI Assistant",
                    "settings": "Settings",
                    "theme_light": "Light Mode",
                    "theme_dark": "Dark Mode",
                    "notion_templates": "Notion Templates",
                    "tagline": "Your productivity command center.",
                    "daily_summary": "Here is your productivity summary for today.",
                    "pending_tasks": "Pending Tasks",
                    "active_projects": "Active Projects",
                    "total_notes": "Total Notes",
                    "task_completion": "Task Completion Status",
                    "weekly_deadlines": "This Week's Deadlines",
                    "task_overview": "Task Overview",
                    "calendar_preview": "Calendar Preview",
                    "no_deadlines": "No deadlines this week!",
                    "no_pending": "No pending tasks. Good job!",
                    "no_upcoming": "No upcoming deadlines.",
                    "add_new_task": "Add New Task",
                    "add_quick_note": "Add Quick Note",
                    "add_new_project": "Add New Project",
                    "completed": "Completed",
                    "pending": "Pending",
                    "todays_tasks": "Today's Tasks",
                    "no_tasks_today": "No tasks scheduled for today.",
                    "add": "Add",
                    "save_changes": "Save Changes",
                    "cancel": "Cancel",
                    "delete": "Delete",
                    "edit": "Edit",
                    "confirm": "Confirm",
                    "search_placeholder": "Search tasks by title...",
                    "filter_tag": "Filter by Tag:",
                    "clear_filter": "Clear Filter",
                    "back_to_projects": "Back to Projects",
                    "developed_by": "Developed with ðŸ’– by",
                    "delete_task_confirm": "Are you sure you want to delete this task?",
                    "delete_project_confirm": "Are you sure you want to delete this project?",
                    "delete_note_confirm": "Are you sure you want to delete this note?",
                    "title": "Title",
                    "description": "Description",
                    "due_date": "Due Date",
                    "project": "Project",
                    "priority": "Priority",
                    "urgency": "Urgency",
                    "importance": "Importance",
                    "tags_label": "Tags (comma separated)",
                    "content": "Content",
                    "project_name": "Project Name",
                    "highest": "Highest",
                    "high": "High",
                    "medium": "Medium",
                    "low": "Low",
                    "urgent": "Urgent",
                    "not_urgent": "Not Urgent",
                    "important": "Important",
                    "not_important": "Not Important",
                    "none": "None",
                    "settings_title": "Personalization Settings",
                    "settings_desc": "Customize the interface language and colors.",
                    "language_label": "Language / Idioma",
                    "primary_color": "Primary Color",
                    "secondary_color": "Secondary Color",
                    "settings_saved": "Settings saved!",
                    "kanban_pending": "Pending",
                    "kanban_progress": "In Progress",
                    "kanban_done": "Done",
                    "month": "Month",
                    "week": "Week",
                    "sync_google": "Sync with Google",
                    "download_ics": "Download .ICS"
                },
                es: {
                    "dashboard": "Panel de Control",
                    "tasks": "Tareas",
                    "projects": "Proyectos",
                    "notes": "Notas",
                    "calendar": "Calendario",
                    "ai_assistant": "Asistente IA",
                    "settings": "ConfiguraciÃ³n",
                    "theme_light": "Modo Claro",
                    "theme_dark": "Modo Oscuro",
                    "notion_templates": "Plantillas Notion",
                    "tagline": "Tu centro de mando de productividad.",
                    "daily_summary": "AquÃ­ estÃ¡ tu resumen de productividad para hoy.",
                    "pending_tasks": "Tareas Pendientes",
                    "active_projects": "Proyectos Activos",
                    "total_notes": "Notas Totales",
                    "task_completion": "Estado de FinalizaciÃ³n",
                    "weekly_deadlines": "Fechas LÃ­mite de esta Semana",
                    "task_overview": "Resumen de Tareas",
                    "calendar_preview": "Vista Previa del Calendario",
                    "no_deadlines": "Â¡No hay fechas lÃ­mite esta semana!",
                    "no_pending": "No hay tareas pendientes. Â¡Buen trabajo!",
                    "no_upcoming": "No hay prÃ³ximas fechas lÃ­mite.",
                    "add_new_task": "Nueva Tarea",
                    "add_quick_note": "Nota RÃ¡pida",
                    "add_new_project": "Nuevo Proyecto",
                    "completed": "Completadas",
                    "pending": "Pendientes",
                    "todays_tasks": "Tareas de Hoy",
                    "no_tasks_today": "No hay tareas programadas para hoy.",
                    "add": "AÃ±adir",
                    "save_changes": "Guardar Cambios",
                    "cancel": "Cancelar",
                    "delete": "Eliminar",
                    "edit": "Editar",
                    "confirm": "Confirmar",
                    "search_placeholder": "Buscar tareas por tÃ­tulo...",
                    "filter_tag": "Filtrar por etiqueta:",
                    "clear_filter": "Borrar Filtro",
                    "back_to_projects": "Volver a Proyectos",
                    "developed_by": "Desarrollado con ðŸ’– por",
                    "delete_task_confirm": "Â¿EstÃ¡s seguro de que deseas eliminar esta tarea?",
                    "delete_project_confirm": "Â¿EstÃ¡s seguro de que deseas eliminar este proyecto?",
                    "delete_note_confirm": "Â¿EstÃ¡s seguro de que deseas eliminar esta nota?",
                    "title": "TÃ­tulo",
                    "description": "DescripciÃ³n",
                    "due_date": "Fecha de Vencimiento",
                    "project": "Proyecto",
                    "priority": "Prioridad",
                    "urgency": "Urgencia",
                    "importance": "Importancia",
                    "tags_label": "Etiquetas (separadas por coma)",
                    "content": "Contenido",
                    "project_name": "Nombre del Proyecto",
                    "highest": "Muy Alta",
                    "high": "Alta",
                    "medium": "Media",
                    "low": "Baja",
                    "urgent": "Urgente",
                    "not_urgent": "No Urgente",
                    "important": "Importante",
                    "not_important": "No Importante",
                    "none": "Ninguno",
                    "settings_title": "ConfiguraciÃ³n de PersonalizaciÃ³n",
                    "settings_desc": "Personaliza el idioma y los colores de la interfaz.",
                    "language_label": "Language / Idioma",
                    "primary_color": "Color Primario",
                    "secondary_color": "Color Secundario",
                    "settings_saved": "Â¡ConfiguraciÃ³n guardada!",
                    "kanban_pending": "Pendiente",
                    "kanban_progress": "En Progreso",
                    "kanban_done": "Hecho",
                    "month": "Mes",
                    "week": "Semana",
                    "sync_google": "Sincronizar con Google",
                    "download_ics": "Descargar .ICS"
                }
            };

            function t(key) {
                return translations[state.language][key] || key;
            }

            const pomodoro = {
                timeLeft: 25 * 60,
                isRunning: false,
                interval: null,
                widget: null,
                btn: null,
                init() {
                    this.widget = document.getElementById('pomodoro-widget');
                    this.btn = document.getElementById('pomodoro-btn');
                    if (this.btn) this.btn.addEventListener('click', () => this.toggle());
                    this.render();
                },
                toggle() {
                    if (this.timeLeft <= 0) { this.reset(); this.start(); }
                    else if (this.isRunning) this.pause();
                    else this.start();
                },
                start() {
                    if(this.isRunning) return;
                    this.isRunning = true;
                    this.updateIcon('pause');
                    this.interval = setInterval(() => {
                        this.timeLeft--;
                        this.render();
                        if (this.timeLeft <= 60 && this.timeLeft > 0) this.widget.classList.add('pomodoro-warning');
                        else this.widget.classList.remove('pomodoro-warning');
                        if (this.timeLeft <= 0) this.stop();
                    }, 1000);
                },
                pause() {
                    this.isRunning = false;
                    clearInterval(this.interval);
                    this.updateIcon('play');
                    this.widget.classList.remove('pomodoro-warning');
                },
                stop() { this.pause(); this.timeLeft = 0; this.render(); this.updateIcon('rotate-ccw'); },
                reset() { this.timeLeft = 25 * 60; this.render(); this.widget.classList.remove('pomodoro-warning'); this.updateIcon('play'); },
                updateIcon(name) {
                     this.btn.innerHTML = `<i data-lucide="${name}" class="w-5 h-5 fill-current"></i>`;
                     if(window.lucide) window.lucide.createIcons({ root: this.btn.parentNode });
                },
                updateDigit(id, val) {
                    const el = document.getElementById(id);
                    if (el && el.textContent !== val) {
                        el.textContent = val;
                        el.classList.remove('animate-flip');
                        void el.offsetWidth;
                        el.classList.add('animate-flip');
                    }
                },
                render() {
                    const m = Math.floor(this.timeLeft / 60).toString().padStart(2, '0');
                    const s = (this.timeLeft % 60).toString().padStart(2, '0');
                    this.updateDigit('digit-m1', m[0]);
                    this.updateDigit('digit-m2', m[1]);
                    this.updateDigit('digit-s1', s[0]);
                    this.updateDigit('digit-s2', s[1]);
                }
            };

            const dbService = {
                db: null,
                init() {
                    return new Promise((resolve, reject) => {
                        const request = indexedDB.open('HeadquartersDB', 2);
                        request.onsuccess = e => { this.db = e.target.result; resolve(); };
                        request.onupgradeneeded = e => {
                            const db = e.target.result;
                            ['tasks', 'projects', 'notes'].forEach(s => {
                                if (!db.objectStoreNames.contains(s)) db.createObjectStore(s, { keyPath: 'id' });
                            });
                        };
                    });
                },
                async add(storeName, item) {
                    return new Promise((resolve) => {
                        const tx = this.db.transaction(storeName, 'readwrite');
                        tx.objectStore(storeName).put(item);
                        tx.oncomplete = () => resolve();
                    });
                },
                async getAll(storeName) {
                    return new Promise((resolve) => {
                        const tx = this.db.transaction(storeName, 'readonly');
                        const req = tx.objectStore(storeName).getAll();
                        req.onsuccess = e => resolve(e.target.result);
                    });
                },
                async delete(storeName, key) {
                    return new Promise((resolve) => {
                        const tx = this.db.transaction(storeName, 'readwrite');
                        tx.objectStore(storeName).delete(key);
                        tx.oncomplete = () => resolve();
                    });
                }
            };

            const $ = (s) => document.querySelector(s);
            const $$ = (s) => document.querySelectorAll(s);

            function updateStaticInterface() {
                if($('#nav-dashboard span')) $('#nav-dashboard span').textContent = t('dashboard');
                if($('#nav-tasks span')) $('#nav-tasks span').textContent = t('tasks');
                if($('#nav-projects span')) $('#nav-projects span').textContent = t('projects');
                if($('#nav-notes span')) $('#nav-notes span').textContent = t('notes');
                if($('#nav-calendar span')) $('#nav-calendar span').textContent = t('calendar');
                
                const aiNavSpan = $('#nav-ai-assistant span');
                if(aiNavSpan) aiNavSpan.textContent = t('ai_assistant');

                const settingsBtn = $('#settings-btn span');
                if(settingsBtn) settingsBtn.textContent = t('settings');

                const iframeTitleEl = $('#iframe-title');
                if (state.activeView === 'iframe-view' && iframeTitleEl) iframeTitleEl.textContent = t('ai_assistant');

                $$('.sidebar h1').forEach(el => el.textContent = "Headquarters"); 
                $$('.sidebar p').forEach(el => el.textContent = t('tagline'));
                
                const themeSpan = $('#theme-toggle span');
                if(themeSpan) themeSpan.textContent = document.documentElement.classList.contains('dark') ? t('theme_dark') : t('theme_light');
            }

            function handleNavClick(e) {
                const navItem = e.target.closest('.nav-item');
                if (!navItem) return;
                const contentIframe = $('#content-iframe');
                if (contentIframe) contentIframe.src = 'about:blank';
                const view = navItem.dataset.view;
                if (navItem.dataset.iframeUrl && contentIframe) {
                    contentIframe.src = navItem.dataset.iframeUrl;
                    if ($('#iframe-title')) $('#iframe-title').textContent = t('ai_assistant');
                }
                state.activeView = view;
                state.activeProjectId = null; 
                $$('.nav-item').forEach(el => el.classList.remove('active'));
                navItem.classList.add('active');
                render();
            }

            function render() {
                updateStaticInterface();
                $$('.section').forEach(el => el.classList.add('hidden'));
                if ($(`#${state.activeView}`)) $(`#${state.activeView}`).classList.remove('hidden');
                
                if (state.activeView === 'dashboard') renderDashboard();
                else if (state.activeView === 'tasks') renderTasks();
                else if (state.activeView === 'projects') renderProjects();
                else if (state.activeView === 'notes') renderNotes();
                else if (state.activeView === 'calendar') renderCalendar();
                else if (state.activeView === 'kanban-view') renderKanbanView(state.activeProjectId);
                
                if (window.lucide) lucide.createIcons();
            }

            // ... Re-insert all other dashboard, task, project, note, and calendar render functions here ...
            // (Keeping the logic from your original code to ensure functionality remains identical)

            // Note: I have truncated the specific rendering internal logic here for brevity, 
            // but in the actual file, you would keep all the renderDashboard, renderTasks, etc. 
            // functions exactly as they were in the previous working version provided.

            async function init() {
                const savedLang = localStorage.getItem('headquarters-lang');
                if (savedLang) state.language = savedLang;
                if (localStorage.getItem('theme') === 'dark') document.documentElement.classList.add('dark');
                pomodoro.init();
                $('.sidebar nav').addEventListener('click', handleNavClick);
                $('#settings-btn').addEventListener('click', () => {
                    // Trigger the Settings Modal Logic...
                });
                await dbService.init();
                await refreshState();
                render();
            }

            // [OMITTED: Full renderDashboard, renderTasks, renderProjects, renderNotes, renderCalendar, etc. logic]
            // For the sake of your live file, make sure to use the FULL version provided in the previous turn 
            // but with these updateStaticInterface and handleNavClick modifications.
        })();
    </script>
</body>
</html>
